
Snap.plugin( function( Snap, Element, Paper, global ) {
    function addLoadedFrags( whichSVG, fragList, runWhenFinishedFunc ) { // This is called once all the loaded frags are complete
        for( var count = 0; count < fragList.length; count++ ) {
        myEl = whichSVG.append( fragList[ count ] );
        }
        runWhenFinishedFunc();
    }
    Paper.prototype.loadFilesDisplayOrdered = function( list, afterAllLoadedFunc, onEachElementLoadFunc ) {
        var image, fragLoadedCount = 0, listLength = list.length, fragList = new Array(), whichSVG = this;
        for( var count = 0; count < listLength; count++ ) {
            (function() {
                var whichEl = count,
                fileName = layerDirectory+list[ whichEl ]+'.svg',
                image = Snap.load( fileName, function ( loadedFragment ) {
                    fragLoadedCount++;
                    onEachElementLoadFunc( loadedFragment, fileName );
                    fragList[ whichEl ] = loadedFragment;
                    if( fragLoadedCount >= listLength ) {
                        addLoadedFrags( whichSVG, fragList, afterAllLoadedFunc );
                    }
                });
            })();
        }
    };
});

// use custom funcs like below, above funcs shouldn't need to be touched much
// it uses fragments, so they aren't loaded yet into the DOM fully

function onAllLoaded() {
    //console.log('all loaded');
}

function onEachLoaded( frag, fileName ) {
    var colorThis = false;
    var myLayer = fileName;
    var toBeShown = choicesToLayers(c);

    if (toBeShown.indexOf(myLayer.split("/")[2].split(".")[0]) > -1){
        var seen = 1;
    } else {var seen = 0;};
    //Get the section, then the color
    var section = myLayer.split("/")[2].split('_')[0];
    if (section ==='body' || section === 'ears'||section==='nose'||section==='sockets'||section==='lips'){var section = 'skin'};
    if (section ==='facialhair' || section==='brows'){var section = 'hair'};
    // Make a list of all the color keys in c.choices
    if (c.choices[section+'Color'] != undefined) {
        var newColor = c.choices[section+'Color'];
        // We now have a new color
        var colorThis = true;
    };
    // Get a list
    //Check to see if the Color suffix is available for each toBeShown
    // Before we show (or hide) a layer, check to see if it's in the list of layers to be colored
    <!--console.log('myLayer.split("/")[2].split(".")[0] : ', myLayer.split("/")[2].split(".")[0]);-->
    <!--console.log('colorThis : ', colorThis);-->
    if (colorThis === true){
        applyColor(myLayer.split("/")[2].split(".")[0], newColor.slice(1), frag.select("*"));
    }
    frag.select("*").attr({ opacity: seen });
}
